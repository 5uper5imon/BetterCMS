define("bcms.contextMenu",["bcms.jquery","bcms"],function(a,b){var g={},k={links:"a"},f={},e={},c={topLeft:"bcms-media-context-tl",bottomLeft:"bcms-media-context-bl",topRight:"bcms-media-context-tr",bottomRight:"bcms-media-context-br"},j=false,h=false,i=false,d=null;g.links=f;g.globalization=e;g.selectors=k;function l(m){if(d!=null){g.closeContext();}d=m;}g.initContext=function(n,o,m){l(n);n.on("mouseover",function(){h=true;});n.on("mouseout",function(){h=false;});n.find(k.links).on("click",g.closeContext);if(m===true){o.on("contextmenu",function(p){g.contextShow(p,null);});}};g.contextMouseDown=function(m){if(i||h){return;}if(m==null){m=window.event;}if(m.button==2){j=true;}else{if(!h){g.closeContext();}}};g.closeContext=function(){h=false;if(d!=null){d.hide();}};g.contextShow=function(p,s){if(i||h){return true;}if(p==null){p=window.event;}if(j){if(s){l(s);}d.hide();var r=10,D=14,B=a(p.currentTarget||p.srcElement),q=(p.pageX||p.clientX)-B.offset().left,C=(p.pageY||p.clientY)-B.offset().top,w=d.scrollParent().height(),A=d.scrollParent().width(),y=d.scrollParent().offset(),z=y?y.top:0,x=y?y.left:0,t=d.outerHeight(),u=d.outerWidth(),v=d.parent().offset(),E=(v?v.top:0)+C+t-z,F=(v?v.left:0)+q+u-x+r,m=false,n=false,o;if(E>w){C=C-t+D;m=true;}else{C-=D;}if(F>A){q=q-u-r;n=true;}else{q+=r;}d.removeClass(c.bottomLeft);d.removeClass(c.bottomRight);d.removeClass(c.topLeft);d.removeClass(c.topRight);o=(m)?(n?c.bottomRight:c.bottomLeft):(n?c.topRight:c.topLeft);d.addClass(o);d.css("left",q+"px");d.css("top",C+"px");d.css("z-index",b.getHighestZindex()+1);d.show();j=false;return false;}return true;};g.disableContext=function(){i=true;g.closeContext();return false;};g.enableContext=function(){i=false;h=false;return false;};g.init=function(){console.log("Initializing bcms.contextMenu module.");a(document).on("mousedown",g.contextMouseDown);};b.registerInit(g.init);return g;});define("bcms.html5Upload",["bcms.jquery"],function(a){var d={},e=function(){},b=window.console||{log:e},f;function g(h){var i=this;i.dropContainer=h.dropContainer;i.inputField=h.inputField;i.uploadsQueue=[];i.activeUploads=0;i.data=h.data;i.key=h.key;i.maxSimultaneousUploads=h.maxSimultaneousUploads||-1;i.onFileAdded=h.onFileAdded||e;i.uploadUrl=h.uploadUrl;i.onFileAddedProxy=function(j){b.log("Event: onFileAdded, file: "+j.fileName);i.onFileAdded(j);};i.initialize();}function c(h){var i=this;i.file=h;i.fileName=h.name;i.fileSize=h.size;i.uploadSize=h.size;i.uploadedBytes=0;i.eventHandlers={};i.abort=function(){b.log("Abort impossible. File upload not initialized for file "+i.fileName);};i.events={onProgress:function(j,l){var k=l/j*100;b.log("Event: upload onProgress, progress = "+k+", fileSize = "+j+", uploadedBytes = "+l);(i.eventHandlers.onProgress||e)(k,j,l);},onStart:function(){b.log("Event: upload onStart");(i.eventHandlers.onStart||e)();},onCompleted:function(j){b.log("Event: upload onCompleted, data = "+j);h=null;(i.eventHandlers.onCompleted||e)(j);},onError:function(k,j){b.log("Event: upload onError (status code "+k+")");h=null;(i.eventHandlers.onError||e)();},onTransfer:function(j){if(j>=100){j=0;}else{j+=10;}(i.eventHandlers.onTransfer||e)(j);}};}c.prototype={on:function(h){this.eventHandlers=h;}};g.prototype={initialize:function(){b.log("Initializing upload manager");var k=this,i=k.dropContainer,j=k.inputField,h=function(l){l.preventDefault();l.stopPropagation();};if(i){k.on(i,"dragover",h);k.on(i,"dragenter",h);k.on(i,"drop",function(l){h(l);k.processFiles(l.dataTransfer.files);});}if(j){k.on(j,"change",function(){k.processFiles(this.files);a(this).val("");});}},processFiles:function(j){b.log("Processing files: "+j.length);var m=this,l=j.length,h,n,k;for(k=0;k<l;k+=1){h=j[k];if(h.size===0){alert("Files with files size zero cannot be uploaded or multiple file uploads are not supported by your browser");break;}n=new c(h);m.uploadFile(n);}},uploadFile:function(i){var h=this;h.onFileAdded(i);if(h.activeUploads===h.maxSimultaneousUploads){b.log("Queue upload: "+i.fileName);h.uploadsQueue.push(i);return;}h.ajaxUpload(i);},ajaxUpload:function(o){var m=this,p,k,j,i=o.file,n,h=m.data,l=m.key||"file";b.log("Begin upload: "+o.fileName);m.activeUploads+=1;p=new window.XMLHttpRequest();k=new window.FormData();j=i.name;p.open("POST",m.uploadUrl);p.upload.onloadstart=function(){b.log("Upload started: "+j);o.events.onStart();};p.upload.onprogress=function(q){if(!q.lengthComputable){return;}o.events.onProgress(q.total,q.loaded);if(q.total==q.loaded){o.events.onTransfer();}};p.onload=function(q){b.log("Upload completed: "+j);m.activeUploads-=1;if(q.target.status===200){o.events.onCompleted(q.target.responseText);}else{o.events.onError(q.target.status,q.target.responseText);}if(m.uploadsQueue.length){m.ajaxUpload(m.uploadsQueue.shift());}};p.onerror=function(q){b.log("Upload failed: ",o.fileName);o.events.onError(q.target.status,q.target.responseText);};if(h){for(n in h){if(h.hasOwnProperty(n)){b.log("Adding data: "+n+" = "+h[n]);k.append(n,h[n]);}}}k.append(l,i);p.send(k);o.abort=function(){b.log("Upload aborted for "+o.fileName);p.abort();m.activeUploads-=1;if(m.uploadsQueue.length){m.ajaxUpload(m.uploadsQueue.shift());}};},on:function(h,i,j){if(!h){return;}if(h.addEventListener){h.addEventListener(i,j,false);}else{if(h.attachEvent){h.attachEvent("on"+i,j);}else{h["on"+i]=j;}}}};d.fileApiSupported=function(){if(typeof f!=="boolean"){var h=document.createElement("input");h.setAttribute("type","file");f=!!h.files;}return f;};d.initialize=function(h){return new g(h);};return d;});define("bcms.jquery.jcrop",["bcms.jquery"],function(a){(function(b){b.Jcrop=function(S,U){var V=b.extend({},b.Jcrop.defaults),D,O,J=false;function X(ax){return ax+"px";}function A(ax){return V.baseClass+"-"+ax;}function aj(){return b.fx.step.hasOwnProperty("backgroundColor");}function I(ax){var ay=b(ax).offset();return[ay.left,ay.top];}function P(ax){return[(ax.pageX-D[0]),(ax.pageY-D[1])];}function ac(ax){if(typeof(ax)!=="object"){ax={};}V=b.extend(V,ax);b.each(["onChange","onSelect","onRelease","onDblClick"],function(az,ay){if(typeof(V[ay])!=="function"){V[ay]=function(){};}});}function ai(ay,aB){D=I(e);ao.setCursor(ay==="move"?ay:ay+"-resize");if(ay==="move"){return ao.activateHandlers(z(aB),E);}var ax=v.getFixed();var aA=T(ay);var az=v.getCorner(T(aA));v.setPressed(v.getCorner(aA));v.setCurrent(az);ao.activateHandlers(F(ay,ax),E);}function F(ay,ax){return function(az){if(!V.aspectRatio){switch(ay){case"e":az[1]=ax.y2;break;case"w":az[1]=ax.y2;break;case"n":az[0]=ax.x2;break;case"s":az[0]=ax.x2;break;}}else{switch(ay){case"e":az[1]=ax.y+1;break;case"w":az[1]=ax.y+1;break;case"n":az[0]=ax.x+1;break;case"s":az[0]=ax.x+1;break;}}v.setCurrent(az);Z.update();};}function z(ay){var ax=ay;N.watchKeys();return function(az){v.moveOffset([az[0]-ax[0],az[1]-ax[1]]);ax=az;Z.update();};}function T(ax){switch(ax){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne";}}function w(ax){return function(ay){if(V.disabled){return false;}if((ax==="move")&&!V.allowMove){return false;}D=I(e);s=true;ai(ax,P(ay));ay.stopPropagation();ay.preventDefault();return false;};}function W(ax,aB,ay){var aA=ax.width(),az=ax.height();if((aA>aB)&&aB>0){aA=aB;az=(aB/ax.width())*ax.height();}if((az>ay)&&ay>0){az=ay;aA=(ay/ax.height())*ax.width();}at=ax.width()/aA;aw=ax.height()/az;ax.width(aA).height(az);}function ap(ax){return{x:ax.x*at,y:ax.y*aw,x2:ax.x2*at,y2:ax.y2*aw,w:ax.w*at,h:ax.h*aw};}function E(ay){var ax=v.getFixed();if((ax.w>V.minSelect[0])&&(ax.h>V.minSelect[1])){Z.enableHandles();Z.done();}else{Z.release();}ao.setCursor(V.allowSelect?"crosshair":"default");}function Q(ax){if(V.disabled){return false;}if(!V.allowSelect){return false;}s=true;D=I(e);Z.disableHandles();ao.setCursor("crosshair");var ay=P(ax);v.setPressed(ay);Z.update();ao.activateHandlers(Y,E);N.watchKeys();ax.stopPropagation();ax.preventDefault();return false;}function Y(ax){v.setCurrent(ax);Z.update();}function R(){var ax=b("<div></div>").addClass(A("tracker"));if(b.browser.msie){ax.css({opacity:0,backgroundColor:"white"});}return ax;}if(b.browser.msie&&(b.browser.version.split(".")[0]==="6")){J=true;}if(typeof(S)!=="object"){S=b(S)[0];}if(typeof(U)!=="object"){U={};}ac(U);var K={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0};var h=b(S),L=true;if(S.tagName=="IMG"){if(h[0].width!=0&&h[0].height!=0){h.width(h[0].width);h.height(h[0].height);}else{var am=new Image();am.src=h[0].src;h.width(am.width);h.height(am.height);}var e=h.clone().removeAttr("id").css(K).show();e.width(h.width());e.height(h.height());h.after(e).hide();}else{e=h.css(K).show();L=false;if(V.shade===null){V.shade=true;}}W(e,V.boxWidth,V.boxHeight);var q=e.width(),r=e.height(),c=b("<div />").width(q).height(r).addClass(A("holder")).css({position:"relative",backgroundColor:V.bgColor}).insertAfter(h).append(e);if(V.addClass){c.addClass(V.addClass);}var g=b("<div />"),f=b("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),d=b("<div />").width("100%").height("100%").css("zIndex",320),i=b("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var ax=v.getFixed();V.onDblClick.call(m,ax);}).insertBefore(e).append(f,d);if(L){g=b("<img />").attr("src",e.attr("src")).css(K).width(q).height(r),f.append(g);}if(J){i.css({overflowY:"hidden"});}var p=V.boundary;var j=R().width(q+(p*2)).height(r+(p*2)).css({position:"absolute",top:X(-p),left:X(-p),zIndex:290}).mousedown(Q);var n=V.bgColor,o=V.bgOpacity,aq,au,ar,av,at,aw,H=true,s,l,ah;D=I(e);var an=(function(){function ay(){var aF={},aC=["touchstart","touchmove","touchend"],az=document.createElement("div"),aD;try{for(aD=0;aD<aC.length;aD++){var aB=aC[aD];aB="on"+aB;var aE=(aB in az);if(!aE){az.setAttribute(aB,"return;");aE=typeof az[aB]=="function";}aF[aC[aD]]=aE;}return aF.touchstart&&aF.touchend&&aF.touchmove;}catch(aA){return false;}}function ax(){if((V.touchSupport===true)||(V.touchSupport===false)){return V.touchSupport;}else{return ay();}}return{createDragger:function(az){return function(aA){aA.pageX=aA.originalEvent.changedTouches[0].pageX;aA.pageY=aA.originalEvent.changedTouches[0].pageY;if(V.disabled){return false;}if((az==="move")&&!V.allowMove){return false;}s=true;ai(az,P(aA));aA.stopPropagation();aA.preventDefault();return false;};},newSelection:function(az){az.pageX=az.originalEvent.changedTouches[0].pageX;az.pageY=az.originalEvent.changedTouches[0].pageY;return Q(az);},isSupported:ay,support:ax()};}());var v=(function(){var aJ=0,aL=0,aK=0,aM=0,aE,aF;function aI(aN){aN=aG(aN);aK=aJ=aN[0];aM=aL=aN[1];}function aH(aN){aN=aG(aN);aE=aN[0]-aK;aF=aN[1]-aM;aK=aN[0];aM=aN[1];}function aA(){return[aE,aF];}function aD(aN){var aO=aN[0],aP=aN[1];if(0>aJ+aO){aO-=aO+aJ;}if(0>aL+aP){aP-=aP+aL;}if(r<aM+aP){aP+=r-(aM+aP);}if(q<aK+aO){aO+=q-(aK+aO);}aJ+=aO;aK+=aO;aL+=aP;aM+=aP;}function ay(aO){var aN=az();switch(aO){case"ne":return[aN.x2,aN.y];case"nw":return[aN.x,aN.y];case"se":return[aN.x2,aN.y2];case"sw":return[aN.x,aN.y2];}}function az(){if(!V.aspectRatio){return aB();}var aN=V.aspectRatio,aR=V.minSize[0]/at,aP=V.maxSize[0]/at,aQ=V.maxSize[1]/aw,aV=aK-aJ,aT=aM-aL,aW=Math.abs(aV),aU=Math.abs(aT),aS=aW/aU,aY,aZ,aX,aO;if(aP===0){aP=q*10;}if(aQ===0){aQ=r*10;}if(aS<aN){aZ=aM;aX=aU*aN;aY=aV<0?aJ-aX:aX+aJ;if(aY<0){aY=0;aO=Math.abs((aY-aJ)/aN);aZ=aT<0?aL-aO:aO+aL;}else{if(aY>q){aY=q;aO=Math.abs((aY-aJ)/aN);aZ=aT<0?aL-aO:aO+aL;}}}else{aY=aK;aO=aW/aN;aZ=aT<0?aL-aO:aL+aO;if(aZ<0){aZ=0;aX=Math.abs((aZ-aL)*aN);aY=aV<0?aJ-aX:aX+aJ;}else{if(aZ>r){aZ=r;aX=Math.abs(aZ-aL)*aN;aY=aV<0?aJ-aX:aX+aJ;}}}if(aY>aJ){if(aY-aJ<aR){aY=aJ+aR;}else{if(aY-aJ>aP){aY=aJ+aP;}}if(aZ>aL){aZ=aL+(aY-aJ)/aN;}else{aZ=aL-(aY-aJ)/aN;}}else{if(aY<aJ){if(aJ-aY<aR){aY=aJ-aR;}else{if(aJ-aY>aP){aY=aJ-aP;}}if(aZ>aL){aZ=aL+(aJ-aY)/aN;}else{aZ=aL-(aJ-aY)/aN;}}}if(aY<0){aJ-=aY;aY=0;}else{if(aY>q){aJ-=aY-q;aY=q;}}if(aZ<0){aL-=aZ;aZ=0;}else{if(aZ>r){aL-=aZ-r;aZ=r;}}return aC(ax(aJ,aL,aY,aZ));}function aG(aN){if(aN[0]<0){aN[0]=0;}if(aN[1]<0){aN[1]=0;}if(aN[0]>q){aN[0]=q;}if(aN[1]>r){aN[1]=r;}return[aN[0],aN[1]];}function ax(aN,aR,aO,aS){var aP=aN,aQ=aO,aT=aR,aU=aS;if(aO<aN){aP=aO;aQ=aN;}if(aS<aR){aT=aS;aU=aR;}return[aP,aT,aQ,aU];}function aB(){var aO=aK-aJ,aP=aM-aL,aN;if(aq&&(Math.abs(aO)>aq)){aK=(aO>0)?(aJ+aq):(aJ-aq);}if(au&&(Math.abs(aP)>au)){aM=(aP>0)?(aL+au):(aL-au);}if(av/aw&&(Math.abs(aP)<av/aw)){aM=(aP>0)?(aL+av/aw):(aL-av/aw);}if(ar/at&&(Math.abs(aO)<ar/at)){aK=(aO>0)?(aJ+ar/at):(aJ-ar/at);}if(aJ<0){aK-=aJ;aJ-=aJ;}if(aL<0){aM-=aL;aL-=aL;}if(aK<0){aJ-=aK;aK-=aK;}if(aM<0){aL-=aM;aM-=aM;}if(aK>q){aN=aK-q;aJ-=aN;aK-=aN;}if(aM>r){aN=aM-r;aL-=aN;aM-=aN;}if(aJ>q){aN=aJ-r;aM-=aN;aL-=aN;}if(aL>r){aN=aL-r;aM-=aN;aL-=aN;}return aC(ax(aJ,aL,aK,aM));}function aC(aN){return{x:aN[0],y:aN[1],x2:aN[2],y2:aN[3],w:aN[2]-aN[0],h:aN[3]-aN[1]};}return{flipCoords:ax,setPressed:aI,setCurrent:aH,getOffset:aA,moveOffset:aD,getCorner:ay,getFixed:az};}());var ag=(function(){var az=false,aC=b("<div />").css({position:"absolute",zIndex:240,opacity:0}),aH={top:ax(),left:ax().height(r),right:ax().height(r),bottom:ax()};function aE(aL,aK){aH.left.css({height:X(aK)});aH.right.css({height:X(aK)});}function aI(){return aJ(v.getFixed());}function aJ(aK){aH.top.css({left:X(aK.x),width:X(aK.w),height:X(aK.y)});aH.bottom.css({top:X(aK.y2),left:X(aK.x),width:X(aK.w),height:X(r-aK.y2)});aH.right.css({left:X(aK.x2),width:X(q-aK.x2)});aH.left.css({width:X(aK.x)});}function ax(){return b("<div />").css({position:"absolute",backgroundColor:V.shadeColor||V.bgColor}).appendTo(aC);}function aA(){if(!az){az=true;aC.insertBefore(e);aI();Z.setBgOpacity(1,0,1);g.hide();aF(V.shadeColor||V.bgColor,1);if(Z.isAwake()){aG(V.bgOpacity,1);}else{aG(1,1);}}}function aF(aK,aL){u(aB(),aK,aL);}function ay(){if(az){aC.remove();g.show();az=false;if(Z.isAwake()){Z.setBgOpacity(V.bgOpacity,1,1);}else{Z.setBgOpacity(1,1,1);Z.disableHandles();}u(c,0,1);}}function aG(aL,aK){if(az){if(V.bgFade&&!aK){aC.animate({opacity:1-aL},{queue:false,duration:V.fadeTime});}else{aC.css({opacity:1-aL});}}}function aD(){V.shade?aA():ay();if(Z.isAwake()){aG(V.bgOpacity);}}function aB(){return aC.children();}return{update:aI,updateRaw:aJ,getShades:aB,setBgColor:aF,enable:aA,disable:ay,resize:aE,refresh:aD,opacity:aG};}());var Z=(function(){var az,aK=370,aA={},aJ={},aG={},aS=false;function aL(aZ){var aY=b("<div />").css({position:"absolute",opacity:V.borderOpacity}).addClass(A(aZ));f.append(aY);return aY;}function aH(aZ,a0){var aY=b("<div />").mousedown(w(aZ)).css({cursor:aZ+"-resize",position:"absolute",zIndex:a0}).addClass("ord-"+aZ);if(an.support){aY.bind("touchstart.jcrop",an.createDragger(aZ));}d.append(aY);return aY;}function aN(aZ){var aY=V.handleSize;return aH(aZ,aK++).css({opacity:V.handleOpacity}).width(aY).height(aY).addClass(A("handle"));}function aM(aY){return aH(aY,aK++).addClass("jcrop-dragbar");}function aC(aZ){var aY;for(aY=0;aY<aZ.length;aY++){aG[aZ[aY]]=aM(aZ[aY]);}}function aB(a0){var aY,aZ;for(aZ=0;aZ<a0.length;aZ++){switch(a0[aZ]){case"n":aY="hline";break;case"s":aY="hline bottom";break;case"e":aY="vline right";break;case"w":aY="vline";break;}aA[a0[aZ]]=aL(aY);}}function aD(aZ){var aY;for(aY=0;aY<aZ.length;aY++){aJ[aZ[aY]]=aN(aZ[aY]);}}function aO(aY,aZ){if(!V.shade){g.css({top:X(-aZ),left:X(-aY)});}i.css({top:X(aZ),left:X(aY)});}function aR(aZ,aY){i.width(aZ).height(aY);}function aP(){var aY=v.getFixed();v.setPressed([aY.x,aY.y]);v.setCurrent([aY.x2,aY.y2]);aX();}function aX(aY){if(az){return aW(aY);}}function aW(aZ){var aY=v.getFixed();aR(aY.w,aY.h);aO(aY.x,aY.y);if(V.shade){ag.updateRaw(aY);}az||aU();if(aZ){V.onSelect.call(m,ap(aY));}else{V.onChange.call(m,ap(aY));}}function aT(a0,aY,aZ){if(!az&&!aY){return;}if(V.bgFade&&!aZ){e.animate({opacity:a0},{queue:false,duration:V.fadeTime});}else{e.css("opacity",a0);}}function aU(){i.show();if(V.shade){ag.opacity(o);}else{aT(o,true);}az=true;}function aQ(){aE();i.hide();if(V.shade){ag.opacity(1);}else{aT(1);}az=false;V.onRelease.call(m);}function aV(){if(aS){d.show();}}function aI(){aS=true;if(V.allowResize){d.show();return true;}}function aE(){aS=false;d.hide();}function ay(aY){if(l===aY){aE();}else{aI();}}function aF(){ay(false);aP();}if(V.dragEdges&&b.isArray(V.createDragbars)){aC(V.createDragbars);}if(b.isArray(V.createHandles)){aD(V.createHandles);}if(V.drawBorders&&b.isArray(V.createBorders)){aB(V.createBorders);}b(document).bind("touchstart.jcrop-ios",function(aY){if(b(aY.currentTarget).hasClass("jcrop-tracker")){aY.stopPropagation();}});var ax=R().mousedown(w("move")).css({cursor:"move",position:"absolute",zIndex:360});if(an.support){ax.bind("touchstart.jcrop",an.createDragger("move"));}f.append(ax);aE();return{updateVisible:aX,update:aW,release:aQ,refresh:aP,isAwake:function(){return az;},setCursor:function(aY){ax.css("cursor",aY);},enableHandles:aI,enableOnly:function(){aS=true;},showHandles:aV,disableHandles:aE,animMode:ay,setBgOpacity:aT,done:aF};}());var ao=(function(){var az=function(){},ay=function(){},aD=V.trackDocument;function aC(){j.css({zIndex:450});if(an.support){b(document).bind("touchmove.jcrop",aG).bind("touchend.jcrop",aF);}if(aD){b(document).bind("mousemove.jcrop",aE).bind("mouseup.jcrop",aH);}}function aB(){j.css({zIndex:290});b(document).unbind(".jcrop");}function aE(aI){az(P(aI));return false;}function aH(aI){aI.preventDefault();aI.stopPropagation();if(s){s=false;ay(P(aI));if(Z.isAwake()){V.onSelect.call(m,ap(v.getFixed()));}aB();az=function(){};ay=function(){};}return false;}function ax(aJ,aI){s=true;az=aJ;ay=aI;aC();return false;}function aG(aI){aI.pageX=aI.originalEvent.changedTouches[0].pageX;aI.pageY=aI.originalEvent.changedTouches[0].pageY;return aE(aI);}function aF(aI){aI.pageX=aI.originalEvent.changedTouches[0].pageX;aI.pageY=aI.originalEvent.changedTouches[0].pageY;return aH(aI);}function aA(aI){j.css("cursor",aI);}if(!aD){j.mousemove(aE).mouseup(aH).mouseout(aH);}e.before(j);return{activateHandlers:ax,setCursor:aA};}());var N=(function(){var ax=b('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}),ay=b("<div />").css({position:"absolute",overflow:"hidden"}).append(ax);function aC(){if(V.keySupport){ax.show();ax.focus();}}function aA(aD){ax.hide();}function az(aD,aE,aF){if(V.allowMove){v.moveOffset([aE,aF]);Z.updateVisible(true);}aD.preventDefault();aD.stopPropagation();}function aB(aD){if(aD.ctrlKey||aD.metaKey){return true;}ah=aD.shiftKey?true:false;var aE=ah?10:1;switch(aD.keyCode){case 37:az(aD,-aE,0);break;case 39:az(aD,aE,0);break;case 38:az(aD,0,-aE);break;case 40:az(aD,0,aE);break;case 27:if(V.allowSelect){Z.release();}break;case 9:return true;}return false;}if(V.keySupport){ax.keydown(aB).blur(aA);if(J||!V.fixedSupport){ax.css({position:"absolute",left:"-20px"});ay.append(ax).insertBefore(e);}else{ax.insertBefore(e);}}return{watchKeys:aC};}());function aa(ax){c.removeClass().addClass(A("holder")).addClass(ax);}function k(ax,aD){var aN=ax[0]/at,aP=ax[1]/aw,aO=ax[2]/at,aQ=ax[3]/aw;if(l){return;}var aB=v.flipCoords(aN,aP,aO,aQ),aC=v.getFixed(),aE=[aC.x,aC.y,aC.x2,aC.y2],az=aE,aF=V.animationDelay,aG=aB[0]-aE[0],aI=aB[1]-aE[1],aH=aB[2]-aE[2],aJ=aB[3]-aE[3],aK=0,aM=V.swingSpeed;x=az[0];y=az[1];aO=az[2];aQ=az[3];Z.animMode(true);var ay;function aL(){window.setTimeout(aA,aF);}var aA=(function(){return function(){aK+=(100-aK)/aM;az[0]=x+((aK/100)*aG);az[1]=y+((aK/100)*aI);az[2]=aO+((aK/100)*aH);az[3]=aQ+((aK/100)*aJ);if(aK>=99.8){aK=100;}if(aK<100){af(az);aL();}else{Z.done();if(typeof(aD)==="function"){aD.call(m);}}};}());aL();}function ae(ax){af([ax[0]/at,ax[1]/aw,ax[2]/at,ax[3]/aw]);V.onSelect.call(m,ap(v.getFixed()));Z.enableHandles();}function af(ax){v.setPressed([ax[0],ax[1]]);v.setCurrent([ax[2],ax[3]]);Z.update();}function al(){return ap(v.getFixed());}function ak(){return v.getFixed();}function ad(ax){ac(ax);M();}function C(){V.disabled=true;Z.disableHandles();Z.setCursor("default");ao.setCursor("default");}function G(){V.disabled=false;M();}function t(){Z.done();ao.activateHandlers(null,null);}function B(){c.remove();h.show();b(S).removeData("Jcrop");}function ab(az,ax){Z.release();C();var ay=new Image();ay.onload=function(){var aD=ay.width;var aC=ay.height;var aB=V.boxWidth;var aA=V.boxHeight;e.width(aD).height(aC);e.attr("src",az);g.attr("src",az);W(e,aB,aA);q=e.width();r=e.height();g.width(q).height(r);j.width(q+(p*2)).height(r+(p*2));c.width(q).height(r);ag.resize(q,r);G();if(typeof(ax)==="function"){ax.call(m);}};ay.src=az;}function u(ax,ay,aA){var az=ay||V.bgColor;if(V.bgFade&&aj()&&V.fadeTime&&!aA){ax.animate({backgroundColor:az},{queue:false,duration:V.fadeTime});}else{ax.css("backgroundColor",az);}}function M(ax){if(V.allowResize){if(ax){Z.enableOnly();}else{Z.enableHandles();}}else{Z.disableHandles();}ao.setCursor(V.allowSelect?"crosshair":"default");Z.setCursor(V.allowMove?"move":"default");if(V.hasOwnProperty("trueSize")){at=V.trueSize[0]/q;aw=V.trueSize[1]/r;}if(V.hasOwnProperty("setSelect")){ae(V.setSelect);Z.done();delete (V.setSelect);}ag.refresh();if(V.bgColor!=n){u(V.shade?ag.getShades():c,V.shade?(V.shadeColor||V.bgColor):V.bgColor);n=V.bgColor;}if(o!=V.bgOpacity){o=V.bgOpacity;if(V.shade){ag.refresh();}else{Z.setBgOpacity(o);}}aq=V.maxSize[0]||0;au=V.maxSize[1]||0;ar=V.minSize[0]||0;av=V.minSize[1]||0;if(V.hasOwnProperty("outerImage")){e.attr("src",V.outerImage);delete (V.outerImage);}Z.refresh();}if(an.support){j.bind("touchstart.jcrop",an.newSelection);}d.hide();M(true);var m={setImage:ab,animateTo:k,setSelect:ae,setOptions:ad,tellSelect:al,tellScaled:ak,setClass:aa,disable:C,enable:G,cancel:t,release:Z.release,destroy:B,focus:N.watchKeys,getBounds:function(){return[q*at,r*aw];},getWidgetSize:function(){return[q,r];},getScaleFactor:function(){return[at,aw];},getOptions:function(){return V;},ui:{holder:c,selection:i}};if(b.browser.msie){c.bind("selectstart",function(){return false;});}h.data("Jcrop",m);return m;};b.fn.Jcrop=function(e,d){var c;this.each(function(){if(b(this).data("Jcrop")){if(e==="api"){return b(this).data("Jcrop");}else{b(this).data("Jcrop").setOptions(e);}}else{if(this.tagName=="IMG"){b.Jcrop.Loader(this,function(){b(this).css({display:"block",visibility:"hidden"});c=b.Jcrop(this,e);if(b.isFunction(d)){d.call(c);}});}else{b(this).css({display:"block",visibility:"hidden"});c=b.Jcrop(this,e);if(b.isFunction(d)){d.call(c);}}}});return this;};b.Jcrop.Loader=function(g,h,e){var c=b(g),f=c[0];function d(){if(f.complete){c.unbind(".jcloader");if(b.isFunction(h)){h.call(f);}}else{window.setTimeout(d,50);}}c.bind("load.jcloader",d).bind("error.jcloader",function(i){c.unbind(".jcloader");if(b.isFunction(e)){e.call(f);}});if(f.complete&&b.isFunction(h)){c.unbind(".jcloader");h.call(f);}};b.Jcrop.defaults={allowSelect:true,allowMove:true,allowResize:true,trackDocument:true,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:false,borderOpacity:0.4,handleOpacity:1,handleSize:7,aspectRatio:0,keySupport:true,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:true,dragEdges:true,fixedSupport:true,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}};}(a));});define("bcms.media.imageeditor",["bcms.jquery","bcms","bcms.modal","bcms.siteSettings","bcms.forms","bcms.dynamicContent","bcms.jquery.jcrop","bcms.ko.extenders"],function(a,b,q,t,f,d,m,o){var h={},r={imageToEdit:".bcms-croped-block img",imageVersionField:"#image-version-field",imageCaption:"#Caption",imageFileName:"#image-file-name",imageFileSize:"#image-file-size",imageAlignment:"input[name=ImageAlign]:checked",imageAlignmentControls:".bcms-alignment-controls",imageEditorForm:"form:first",imageSizeEditBoxWidth:"#image-width",imageSizeEditBoxHeight:"#image-height",imageTitleEditInput:"#bcms-image-title-editor",imageToCrop:".bcms-croped-block img"},p={imageEditorDialogUrl:null,imageEditorInsertDialogUrl:null},g={imageEditorDialogTitle:null,imageEditorInsertDialogTitle:null,imageEditorInsertDialogAcceptButton:null,imageEditorUpdateFailureMessageTitle:null,imageEditorUpdateFailureMessageMessage:null},c={maxHeightToFit:557,maxWidthToFit:839,jcropBackgroundColor:"#F5F5F5"},n=null;h.links=p;h.globalization=g;h.onEditImage=function(w,v){h.showImageEditorDialog(w,v);};h.onInsertImage=function(w,v){h.showImageEditorInsertDialog(w,v);};h.showImageEditorDialog=function(w,v){q.open({title:g.imageEditorDialogTitle,onLoad:function(x){var y=a.format(p.imageEditorDialogUrl,w);d.bindDialog(x,y,{contentAvailable:k,beforePost:function(){var z=a(r.imageToEdit).data("version");if(z>0){a(r.imageVersionField).val(z);}},postSuccess:function(z){if(z.Success){v(z.Data);}x.close();},postError:function(){q.alert({title:g.imageEditorUpdateFailureMessageTitle,content:g.imageEditorUpdateFailureMessageMessage});}});}});};h.showImageEditorInsertDialog=function(w,v){q.open({title:g.imageEditorInsertDialogTitle,acceptTitle:g.imageEditorInsertDialogAcceptButton,onLoad:function(x){var y=a.format(p.imageEditorInsertDialogUrl,w.id());d.setContentFromUrl(x,y,{done:function(){l(x);}});},onAccept:function(z){var A=z.container.find(r.imageToEdit).attr("src"),y=z.container.find(r.imageCaption).val(),x=z.container.find(r.imageAlignment).val();z.close();v(w,A,y,x);return false;}});};var e=(function(){function v(){var w=this;w.isOpened=o.observable(false);w.open=function(){w.isOpened(true);};w.close=function(){w.onClose();w.isOpened(false);};w.save=function(x){if(w.onSave(a(x))){w.isOpened(false);}};}v.prototype.onSave=function(){};v.prototype.onClose=function(){};return v;})();var u=(function(v){b.extendsClass(w,v);function w(x,z){v.call(this);var y=this;y.input=x.container.find(r.imageTitleEditInput);y.title=o.observable(z);y.oldTitle=o.observable(z);}w.prototype.onSave=function(){if(this.input.valid()){this.oldTitle(this.title());return true;}return false;};w.prototype.onClose=function(){this.title(this.oldTitle());this.input.blur();};return w;})(e);var i=(function(v){b.extendsClass(w,v);function w(z,B){v.call(this);var D=this;D.dialog=z;D.widthInput=z.container.find(r.imageSizeEditBoxWidth);D.heightInput=z.container.find(r.imageSizeEditBoxHeight);D.image=z.container.find(r.imageToCrop);D.originalWidth=B.OriginalImageWidth;D.originalHeight=B.OriginalImageHeight;D.width=o.observable(B.ImageWidth);D.height=o.observable(B.ImageHeight);D.oldWidth=o.observable(B.ImageWidth);D.oldHeight=o.observable(B.ImageHeight);D.fit=o.observable(false);D.calculatedWidth=o.observable(B.ImageWidth);D.calculatedHeight=o.observable(B.ImageHeight);D.cropCoordX1=o.observable(B.CropCoordX1);D.cropCoordX2=o.observable(B.CropCoordX2);D.cropCoordY1=o.observable(B.CropCoordY1);D.cropCoordY2=o.observable(B.CropCoordY2);D.keepAspectRatio=o.observable(false);D.url=B.OriginalImageUrl+"?version="+B.Version;D.fit.subscribe(function(){C();});D.oldWidth.subscribe(function(){C();});D.oldHeight.subscribe(function(){C();});D.keepAspectRatio.subscribe(function(){D.changeHeight();});D.widthAndHeight=o.computed(function(){return D.oldWidth()+" x "+D.oldHeight();});D.changeHeight=function(){if(D.keepAspectRatio()&&D.widthInput.valid()&&D.oldWidth!=D.width()){var E=D.width()/(D.originalWidth||1);D.height(Math.round(D.originalHeight*E));}return true;};D.changeWidth=function(){if(D.keepAspectRatio()&&D.heightInput.valid()&&D.oldHeight!=D.height()){var E=D.height()/(D.originalHeight||1);D.width(Math.round(D.originalWidth*E));}return true;};D.calculateWidth=o.computed(function(){if(D.fit()&&D.width()>c.maxWidthToFit){return c.maxWidthToFit;}return D.width();});D.calculateHeight=o.computed(function(){if(D.fit()&&D.height()>c.maxHeightToFit){return c.maxHeightToFit;}return D.height();});D.restoreOriginalSize=function(){D.width(D.originalWidth);D.height(D.originalHeight);D.save();};D.onCropCoordsUpdated=function(E){if(E!=null){D.cropCoordX1(E.x);D.cropCoordY1(E.y);D.cropCoordX2(E.x2);D.cropCoordY2(E.y2);}else{D.removeCrop();}};D.hasCrop=o.computed(function(){return D.cropCoordX1()!=0||D.cropCoordY1()!=0||D.cropCoordX2()!=D.originalWidth||D.cropCoordY2()!=D.originalHeight;});D.removeCrop=function(){D.cropCoordX1(0);D.cropCoordY1(0);D.cropCoordX2(D.originalWidth);D.cropCoordY2(D.originalHeight);x();};D.changeFit=function(){D.fit(!D.fit());};D.changeAspectRatio=function(){D.keepAspectRatio(!D.keepAspectRatio());};function C(){var F=D.oldWidth(),E=D.oldHeight(),G=c.maxWidthToFit>0?F/c.maxWidthToFit:0,H=c.maxHeightToFit>0?E/c.maxHeightToFit:0;if(D.fit()&&(E>c.maxHeightToFit||F>c.maxWidthToFit)){if(G>H){F=c.maxWidthToFit;E=G>0?E/G:0;}else{E=c.maxHeightToFit;F=H>0?F/H:0;}}D.calculatedWidth(F);D.calculatedHeight(E);if(n!=null){x();}}function A(){y();n=null;D.image.load(function(){D.fit(true);x();});D.image.attr("src",D.url);}function x(){y();var E={onChange:D.onCropCoordsUpdated,onSelect:D.onCropCoordsUpdated,onRelease:D.onCropCoordsUpdated,trueSize:[D.originalWidth,D.originalHeight],bgColor:c.jcropBackgroundColor};if(D.hasCrop()){E.setSelect=[D.cropCoordX1(),D.cropCoordY1(),D.cropCoordX2(),D.cropCoordY2()];}setTimeout(function(){D.image.Jcrop(E,function(){n=this;});},10);}function y(){if(n!=null){n.destroy();}}A();}w.prototype.onSave=function(x){if(x.get(0)==this.widthInput.get(0)){this.changeHeight();}else{if(x.get(0)==this.heightInput.get(0)){this.changeWidth();}}if(this.widthInput.valid()&&this.heightInput.valid()){this.oldWidth(this.width());this.oldHeight(this.height());return true;}return false;};w.prototype.onClose=function(){this.width(this.oldWidth());this.height(this.oldHeight());this.heightInput.blur();this.widthInput.blur();};return w;})(e);function j(x,v){var w=this;w.titleEditorViewModel=x;w.imageEditorViewModel=v;}function k(x,v){var w=v.Data?v.Data:{};var z=new u(x,w.Title);var y=new i(x,w);var A=new j(z,y);o.applyBindings(A,x.container.find(r.imageEditorForm).get(0));x.container.find(r.imageAlignmentControls).children().each(function(){s(this,x);});}function l(v){v.container.find(r.imageAlignmentControls).children().each(function(){s(this,v);});}function s(w,v){a(w).on("click",function(){v.container.find(r.imageAlignmentControls).children().each(function(){a(this).attr("class",a(this).attr("class").replace("-active",""));a("input",this).removeAttr("checked");});a(w).attr("class",a(w).attr("class")+"-active");a("input",w).attr("checked","true");});}return h;});define("bcms.media",["bcms.jquery","bcms","bcms.modal","bcms.siteSettings","bcms.forms","bcms.dynamicContent","bcms.messages","bcms.media.upload","bcms.media.imageeditor","bcms.htmlEditor","bcms.ko.extenders","bcms.contextMenu","bcms.security"],function(a,e,W,ad,s,o,V,S,w,v,E,U,ab){var H={},ac={tabImagesContainer:"#bcms-tab-1",tabVideosContainer:"#bcms-tab-2",tabAudiosContainer:"#bcms-tab-3",tabFilesContainer:"#bcms-tab-4",tabImagesSelector:"#bcms-tab-images",tabVideosSelector:"#bcms-tab-videos",tabAudiosSelector:"#bcms-tab-audios",tabFilesSelector:"#bcms-tab-files",templateDataBind:".bcms-data-bind-container",firstForm:"form:first",spinContainer:".bcms-rightcol:first",insertContentContainer:".bcms-insert-content-modal:first",searchBox:"#bcms-search-input",fileListMessageBox:"#bcms-site-settings-media-messages-"},F={loadSiteSettingsMediaManagerUrl:null,loadImagesUrl:null,loadFilesUrl:null,loadAudiosUrl:null,loadVideosUrl:null,insertImageDialogUrl:null,insertFileDialogUrl:null,deleteAudioUrl:null,deleteVideoUrl:null,deleteImageUrl:null,deleteFileUrl:null,getImageUrl:null,saveFolderUrl:null,renameMediaUrl:null,getMediaUrl:null,downloadFileUrl:null},u={deleteImageConfirmMessage:null,deleteAudioConfirmMessage:null,deleteVideoConfirmMessage:null,deleteFileConfirmMessage:null,deleteFolderConfirmMessage:null,insertImageDialogTitle:null,insertImageFailureMessageTitle:null,insertImageFailureMessageMessage:null,imageNotSelectedMessageMessage:null,insertFileFailureMessageTitle:null,insertFileFailureMessageMessage:null,insertFileDialogTitle:null,fileNotSelectedMessageMessage:null,imagesTabTitle:null,audiosTabTitle:null,videosTabTitle:null,filesTabTitle:null,uploadImage:null,uploadAudio:null,uploadVideo:null,uploadFile:null},D={folderViewMode:"bcms.mediaFolderViewMode"},R={image:1,video:2,audio:3,file:4},k={file:1,folder:2},ae={ascending:0,descending:1},y=null,d=null,ag=null,r=null,af=1,j=null,x=null,q=null,f=null;H.links=F;H.globalization=u;function O(ah){var ai=this;ai.searchQuery=E.observable(ah.GridOptions.SearchQuery);if(ah.GridOptions){ai.column=E.observable(ah.GridOptions.Column);ai.isDescending=E.observable(ah.GridOptions.Direction==ae.descending);}}function P(ah,al,ai){var ak=this,aj=function(aq){if(aq&&aq.Data){var am=ak.path().currentFolder().id();var ar=aq.Data.SelectedFolderId;if(am==ar&&aq.Data.Medias&&aq.Data.Medias.length>0){var ap=aq.Data.Medias;for(var an=ap.length-1;an>=0;an--){var ao=l(ap[an]);ak.medias.unshift(ao);e.updateFormValidator(ak.container.find(ac.firstForm));}}}};ak.container=ah;ak.messagesContainer=ai;ak.url=al;ak.onMediaSelect=null;ak.medias=E.observableArray();ak.path=E.observable();ak.isGrid=E.observable(localStorage.getItem(D.folderViewMode)==1);ak.canSelectMedia=E.observable(false);ak.canInsertMedia=E.observable(false);ak.canInsertMediaWithOptions=E.observable(false);ak.rowAdded=false;ak.gridOptions=E.observable();ak.isRootFolder=function(){if(ak.path!=null&&ak.path().folders!=null&&ak.path().folders().length>1){return false;}return true;};ak.showNoDataInfoDiv=function(){return ak.isRootFolder()&&ak.medias().length==0;};ak.addNewFolder=function(){if(!ak.rowAdded){ak.rowAdded=true;var am=new K({IsActive:true,Type:ak.path().currentFolder().type});ak.medias.unshift(am);e.updateFormValidator(ak.container.find(ac.firstForm));}};ak.uploadMedia=function(){S.openUploadFilesDialog(ak.path().currentFolder().id(),ak.path().currentFolder().type,aj);V.refreshBox(a(ac.fileListMessageBox+ak.path().type),{});};ak.searchMedia=function(){var an=m(ak.path().currentFolder().id(),ak),am=function(ao){Z(ao,ak);a(ac.searchBox).focus();};G(ak,an,am);};ak.sortMedia=function(am){var an=ak.gridOptions().column(),aq=ak.gridOptions().isDescending();if(an==am){ak.gridOptions().isDescending(!aq);}else{ak.gridOptions().isDescending(false);}ak.gridOptions().column(am);var ap=m(ak.path().currentFolder().id(),ak),ao=function(ar){Z(ar,ak);};G(ak,ap,ao);};ak.switchViewStyle=function(){var am=!ak.isGrid();localStorage.setItem(D.folderViewMode,am?1:0);a.each([y,d,ag,r],function(an,ao){if(ao&&ao.isGrid){ao.isGrid(am);}});};ak.isSortedAscending=function(am){if(am==ak.gridOptions().column()&&!ak.gridOptions().isDescending()){return true;}return false;};ak.isSortedDescending=function(am){if(am==ak.gridOptions().column()&&ak.gridOptions().isDescending()){return true;}return false;};ak.uploadButtonTitle=function(){switch(ak.path().type){case R.image:return u.uploadImage;case R.audio:return u.uploadAudio;case R.video:return u.uploadVideo;case R.file:return u.uploadFile;}return null;};ak.openRoot=function(){i(null,ak);};ak.domId=function(){return"bcms-site-settings-media-messages-"+ak.path().type;};}function Q(ai){var ah=this;ah.currentFolder=E.observable();ah.folders=E.observableArray();ah.type=ai;ah.pathFolders=E.computed(function(){var al=ah.folders(),ak=4,aj;if(al.length>ak){for(aj=0;aj<al.length;aj++){if(aj<=ak){al.remove(al[aj]);}}}if(al.length>0){switch(ah.type){case R.image:al[0].name(u.imagesTabTitle);break;case R.audio:al[0].name(u.audiosTabTitle);break;case R.video:al[0].name(u.videosTabTitle);break;case R.file:al[0].name(u.filesTabTitle);break;}}return al;});}function N(){var ah=this;ah.initialized=false;ah.domId="cmenu_"+af++;ah.show=function(ai,aj){var ak=a("#"+ah.domId);if(!ah.initialized){ah.initialized=true;U.initContext(ak,aj.target,false);}U.contextShow(aj,ak);};ah.close=function(ai,aj){U.closeContext();};}var M=(function(){function ah(ai){var aj=this;aj.id=E.observable(ai.Id);aj.name=E.observable(ai.Name);aj.oldName=ai.Name;aj.version=E.observable(ai.Version);aj.publicUrl=E.observable(ai.PublicUrl);aj.extension=ai.FileExtension;aj.type=ai.Type;aj.nameDomId="name_"+af++;aj.updateUrl=F.renameMediaUrl;aj.isProcessing=E.observable(ai.IsProcessing||false);aj.isFailed=E.observable(ai.IsFailed||false);aj.savePressed=false;aj.isActive=E.observable(ai.IsActive||false);aj.isSelected=E.observable(false);aj.isDeleting=E.observable(false);aj.contextMenu=new N();aj.isFile=function(){return !aj.isFolder();};aj.canBeEdited=function(){return aj.isImage();};aj.canBeDownloaded=function(){return aj.publicUrl();};aj.stopEvent=function(ak,al){e.stopEventPropagation(al);};aj.downloadMedia=function(){window.open(a.format(F.downloadFileUrl,aj.id()),"_newtab");};aj.rowClassNames=E.computed(function(){var ak="";if(aj.isFolder()){ak+=" bcms-folder-box";if(aj.isActive()){ak+=" bcms-folder-box-active";}}if(aj.isFile()&&!aj.isImage()){ak+=" bcms-file-box";}if(aj.isImage()){ak+=" bcms-image-box";}if(aj.isFile()&&aj.isActive()){if(!aj.isImage()){ak+=" bcms-file-box-active";}else{ak+=" bcms-image-box-active";}}if(aj.isSelected()){ak+=" bcms-media-click-active";}return a.trim(ak);});aj.iconClassNames=E.computed(function(){var ak="";if(aj.isFolder()){ak+=" bcms-system-folder";}if(aj.isImage()){ak+=" bcms-media-file-holder";}if(aj.isFile()&&!aj.isImage()){ak+=" bcms-system-file";}if(!aj.isImage()&&aj.extension){ak+=t(aj.extension);}return a.trim(ak);});}ah.prototype.isFolder=function(){return false;};ah.prototype.isImage=function(){return false;};ah.prototype.deleteMedia=function(ai){throw new Error("Delete method is not implemented.");};ah.prototype.openMedia=function(ak,ai,aj){e.stopEventPropagation(aj);p(ak,this,ai,aj);};ah.prototype.editMedia=function(ak,ai,aj){e.stopEventPropagation(aj);if(this.isDeleting()){return;}this.renameMedia(ak,ai,aj);};ah.prototype.renameMedia=function(ak,ai,aj){e.stopEventPropagation(aj);if(this.isDeleting()){return;}this.isActive(true);};ah.prototype.openMedia=function(ak,ai,aj){e.stopEventPropagation(aj);p(ak,this,ai,aj);V.refreshBox(a(ac.fileListMessageBox+this.type),{});};ah.prototype.saveMedia=function(ak,ai,aj){e.stopEventPropagation(aj);this.savePressed=true;aa(ak,this);};ah.prototype.blurMediaField=function(ai){h(ai,this);};ah.prototype.insertMedia=function(ai){throw new Error("Insert media method is not implemented.");};ah.prototype.insertMediaWithOptions=function(ai){throw new Error("Insert media with options method is not implemented.");};ah.prototype.cancelEditMedia=function(ak,ai,aj){e.stopEventPropagation(aj);g(ak,this);};ah.prototype.toJson=function(){var ai={Id:this.id(),Name:this.name(),Version:this.version(),Type:this.type};return ai;};return ah;})();var L=(function(ah){e.extendsClass(ai,ah);function ai(aj){ah.call(this,aj);var ak=this;ak.tooltip=aj.Tooltip;ak.thumbnailUrl=aj.ThumbnailUrl;ak.getImageUrl=function(){if(!ak.thumbnailUrl){return null;}return ak.thumbnailUrl+"?version="+ak.version();};ak.previewImage=function(){var al=ak.publicUrl()+"?version="+ak.version();if(al){W.imagePreview(al,ak.tooltip);}};}ai.prototype.isImage=function(){return true;};ai.prototype.deleteMedia=function(al,aj,ak){e.stopEventPropagation(ak);var an=a.format(F.deleteImageUrl,this.id(),this.version()),am=a.format(u.deleteImageConfirmMessage,this.name());n(an,am,al,this);};ai.prototype.editMedia=function(al,aj,ak){e.stopEventPropagation(ak);if(this.isDeleting()){return;}if(ab.IsAuthorized(["BcmsEditContent"])){var am=this;w.onEditImage(am.id(),function(an){am.version(an.Version);am.name(an.Title);am.oldName=an.Title;});}};ai.prototype.insertMedia=function(al,aj,ak){e.stopEventPropagation(ak);C(this,false,al.onMediaSelect);};ai.prototype.insertMediaWithOptions=function(al,aj,ak){e.stopEventPropagation(ak);C(this,true,al.onMediaSelect);};return ai;})(M);var I=(function(ah){e.extendsClass(ai,ah);function ai(aj){ah.call(this,aj);}ai.prototype.deleteMedia=function(al,aj,ak){e.stopEventPropagation(ak);var an=a.format(F.deleteAudioUrl,this.id(),this.version()),am=a.format(u.deleteAudioConfirmMessage,this.name());n(an,am,al,this);};return ai;})(M);var T=(function(ah){e.extendsClass(ai,ah);function ai(aj){ah.call(this,aj);}ai.prototype.deleteMedia=function(al,aj,ak){e.stopEventPropagation(ak);var an=a.format(F.deleteVideoUrl,this.id(),this.version()),am=a.format(u.deleteVideoConfirmMessage,this.name());n(an,am,al,this);};return ai;})(M);var J=(function(ah){e.extendsClass(ai,ah);function ai(aj){ah.call(this,aj);}ai.prototype.deleteMedia=function(al,aj,ak){e.stopEventPropagation(ak);var an=a.format(F.deleteFileUrl,this.id(),this.version()),am=a.format(u.deleteFileConfirmMessage,this.name());n(an,am,al,this);};ai.prototype.insertMedia=function(al,aj,ak){e.stopEventPropagation(ak);B(this);};return ai;})(M);var K=(function(ah){e.extendsClass(ai,ah);function ai(aj){ah.call(this,aj);var ak=this;ak.updateUrl=F.saveFolderUrl;ak.pathName=E.computed(function(){return ak.name()+"/";});}ai.prototype.isFolder=function(){return true;};ai.prototype.deleteMedia=function(al,aj,ak){e.stopEventPropagation(ak);var an=a.format(F.deleteFolderUrl,this.id(),this.version()),am=a.format(u.deleteFolderConfirmMessage,this.name());n(an,am,al,this);};ai.prototype.openMedia=function(al,aj,ak){e.stopEventPropagation(ak);if(this.isDeleting()){return;}i(this.id(),al);};return ai;})(M);function p(aj,al,ah,ai){if(al.isProcessing()||al.isFailed()||al.isDeleting()){return;}if(!aj.canSelectMedia()){al.editMedia(aj,ah,ai);return;}for(var ak=0;ak<aj.medias().length;ak++){aj.medias()[ak].isSelected(false);}al.isSelected(true);}function h(ah,ai){f=setTimeout(function(){if(!ai.name()&&!ai.id()){g(ah,ai);}else{aa(ah,ai);}},500);}function g(ah,ak){ak.isActive(false);ah.rowAdded=false;if(!ak.id()){ah.medias.remove(ak);}else{ak.name(ak.oldName);var ai="#"+ak.nameDomId,aj=ah.container.find(ai);aj.valid();}}function aa(ah,ak){if(ak.isDeleting()){return;}var ai="#"+ak.nameDomId,aj=ah.container.find(ai),al=a(aj.closest(ad.selectors.loaderContainer).get(0)||aj.closest(W.selectors.scrollWindow).get(0));clearTimeout(f);ah.rowAdded=false;if(ak.savePressed||(ak.oldName!=ak.name()&&ak.isActive())){if(aj.valid()){var an=ak.toJson(),am=function(ao){al.hideLoading();V.refreshBox(ah.container,ao);if(ao.Success&&ao.Data){ak.version(ao.Data.Version);ak.id(ao.Data.Id);ak.oldName=ak.name();}else{ak.isActive(true);}ak.isActive(false);};al.showLoading();ak.isActive(false);a.ajax({url:ak.updateUrl,type:"POST",dataType:"json",cache:false,data:an}).done(function(ao){am(ao);}).fail(function(ao){am(e.parseFailedResponse(ao));});}else{if(ak.savePressed){aj.focus();}}}else{ak.isActive(false);}ak.savePressed=false;}function t(ah){if(ah.indexOf(".")===0){ah=ah.substring(1,ah.length);}switch(ah.toLowerCase()){case"pdf":return" bcms-pdf-icn";case"doc":case"docx":return" bcms-word-icn";case"xls":case"xlsx":return" bcms-xls-icn";case"mp3":return" bcms-mp3-icn";case"mp4":return" bcms-mp4-icn";case"ppt":case"pptx":return" bcms-ppt-icn";case"rar":return" bcms-rar-icn";case"wav":return" bcms-wav-icn";case"zip":return" bcms-zip-icn";default:return" bcms-uknown-icn";}}H.loadSiteSettingsMediaManager=function(){o.bindSiteSettings(ad,F.loadSiteSettingsMediaManagerUrl,{contentAvailable:z});};H.openImageInsertDialog=function(aj,ah,ai,ak){W.open({title:u.insertImageDialogTitle,acceptTitle:"Insert",onClose:ak,onLoad:function(al){x=al;o.setContentFromUrl(al,F.insertImageDialogUrl,{done:function(am){y=new P(al.container,F.loadImagesUrl,al.container);y.canSelectMedia(true);y.canInsertMedia(true);y.canInsertMediaWithOptions(ah);y.spinContainer=al.container.find(ac.insertContentContainer);if(ai){y=a.extend(y,ai);}A(am,y);}});},onAcceptClick:function(){var al,am,an=null;for(al=0;al<y.medias().length;al++){am=y.medias()[al];if(am.isSelected()&&am.type==R.image){an=am;break;}}if(an==null){W.info({content:u.imageNotSelectedMessageMessage,disableCancel:true});return false;}else{if(a.isFunction(aj)){aj(an);}}return true;}});};function Y(ah){j=ah;H.openImageInsertDialog(function(ai){C(ai,false);},true);}function C(al,an,ak){if(al.isDeleting()){return;}var aj=al.id(),ah=function(){W.alert({title:u.insertImageFailureMessageTitle,content:u.insertImageFailureMessageMessage});},ai=function(aq,ar,ap,ao){if(a.isFunction(ak)){ak(aq,ar,ap,ao);}else{c(ar,ap,ao,aq.version());}if(x!=null){x.close();x=null;}};if(an===true){w.onInsertImage(al,ai);}else{var am=a.format(F.getImageUrl,aj);a.ajax({url:am,type:"POST",dataType:"json"}).done(function(ao){if(ao.Success&&ao.Data!=null){ai(al,ao.Data.Url,ao.Data.Caption,ao.Data.ImageAlign);}else{ah();}}).fail(function(){ah();});}}function c(ak,ai,aj,an){ai=ai||"";if(j!=null){var ah="left";if(aj==2){ah="center";}else{if(aj==3){ah="right";}}if(ak.indexOf("?")<0){ak+="?version="+an;}else{ak+="&version="+an;}var al="";if(aj==2){al='<img src="'+ak+'" alt="'+ai+'"/>';}else{al='<img src="'+ak+'" alt="'+ai+'" style="float:'+ah+'"/>';}if(j.mode=="source"){var am=j.getData();j.setData(am+al);}else{j.insertHtml(al);}}}H.openFileInsertDialog=function(ah){W.open({title:u.insertFileDialogTitle,acceptTitle:"Insert",onLoad:function(ai){q=ai;o.setContentFromUrl(ai,F.insertFileDialogUrl,{done:function(aj){r=new P(ai.container,F.loadFilesUrl,ai.container);r.canSelectMedia(true);r.canInsertMedia(true);r.spinContainer=ai.container.find(ac.insertContentContainer);A(aj,r);}});},onAcceptClick:function(){var ai,aj,ak=null;for(ai=0;ai<r.medias().length;ai++){aj=r.medias()[ai];if(aj.isSelected()&&aj.type==R.file){ak=aj;break;}}if(ak==null){W.info({content:u.fileNotSelectedMessageMessage,disableCancel:true});return false;}else{if(a.isFunction(ah)){ah(ak);}}return true;}});};function B(ah){b(a.format(F.downloadFileUrl,ah.id()),ah.name());if(q!=null){q.close();q=null;}}function X(ah){j=ah;H.openFileInsertDialog(function(ai){B(ai);});}function b(aj,ai){if(j!=null){if(j.mode=="source"){var ah='<a href="'+aj+'">'+ai+"</a>";var ak=j.getData();j.setData(ak+ah);}else{j.insertHtml('<a href="'+aj+'">'+ai+"</a>");}}}function n(am,ak,ai,aj){if(aj.isProcessing()||aj.isDeleting()){return;}var al=function(an){V.refreshBox(ai.container,an);if(an.Success){ai.medias.remove(aj);}else{aj.isDeleting(false);}ah.close();},ah=W.confirm({content:ak,onAccept:function(){aj.isDeleting(true);a.ajax({type:"POST",url:am,contentType:"application/json; charset=utf-8",dataType:"json",cache:false}).done(function(an){al(an);}).fail(function(an){al(e.parseFailedResponse(an));});}});}function m(ah,ai){var aj={CurrentFolderId:ah};if(ai!=null&&ai.gridOptions()!=null){var ak=ai.gridOptions().searchQuery();if(ak){aj.SearchQuery=ak;}aj.Column=ai.gridOptions().column();aj.Direction=ai.gridOptions().isDescending()?ae.descending:ae.ascending;}return aj;}function i(ai,ah){var ak=m(ai,null),aj=function(al){V.refreshBox(ah.container,{});Z(al,ah);};G(ah,ak,aj);}function Z(al,ai){var aj;V.refreshBox(ai.container,al);if(al.Success){ai.medias.removeAll();if(al.Data){if(al.Data.Path){var ao=new Q(al.Data.Path.CurrentFolder.Type);if(al.Data.Path.CurrentFolder){var ah=new K(al.Data.Path.CurrentFolder);ao.currentFolder(ah);}if(al.Data.Path.Folders&&a.isArray(al.Data.Path.Folders)){for(aj=0;aj<al.Data.Path.Folders.length;aj++){var an=new K(al.Data.Path.Folders[aj]);ao.folders.push(an);}}ai.path(ao);}if(al.Data.Items&&al.Data.Items&&a.isArray(al.Data.Items)){for(aj=0;aj<al.Data.Items.length;aj++){var ak=al.Data.Items[aj],am=l(ak);if(am!=null){ai.medias.push(am);}}}ai.gridOptions(new O(al.Data));e.updateFormValidator(ai.container.find(ac.firstForm));}return true;}return false;}function l(ah){var ai;if(ah.ContentType==k.folder){ai=new K(ah);}else{switch(ah.Type){case R.image:ai=new L(ah);break;case R.audio:ai=new I(ah);break;case R.video:ai=new T(ah);break;case R.file:ai=new J(ah);break;default:ai=null;break;}}return ai;}function G(ai,al,ah){var aj="mediatab",am=ai.spinContainer,ak=function(an){am.hideLoading(aj);if(a.isFunction(ah)){ah(an);}};am.showLoading(aj);a.ajax({type:"POST",cache:false,url:ai.url,data:al}).done(function(an){ak(an);}).fail(function(an){ak(e.parseFailedResponse(an));});}function A(aj,ai){var ah=ai.container.find(ac.templateDataBind).get(0);if(Z(aj,ai)){E.applyBindings(ai,ah);e.updateFormValidator(ai.container.find(ac.firstForm));}}function z(ah){r=null;d=null;ag=null;var ai=ad.getModalDialog().container;ai.find(ac.tabAudiosSelector).on("click",function(){var ak=ai.find(ac.tabAudiosContainer);if(d==null){d=new P(ak,F.loadAudiosUrl,ai);d.spinContainer=ak.parents(ac.spinContainer);G(d,null,function(al){A(al,d);});}});ai.find(ac.tabVideosSelector).on("click",function(){var ak=ai.find(ac.tabVideosContainer);if(ag==null){ag=new P(ak,F.loadVideosUrl,ai);ag.spinContainer=ak.parents(ac.spinContainer);G(ag,null,function(al){A(al,ag);});}});ai.find(ac.tabFilesSelector).on("click",function(){var ak=ai.find(ac.tabFilesContainer);if(r==null){r=new P(ak,F.loadFilesUrl,ai);r.spinContainer=ak.parents(ac.spinContainer);G(r,null,function(al){A(al,r);});}});var aj=ai.find(ac.tabImagesContainer);y=new P(aj,F.loadImagesUrl,ai);y.spinContainer=aj.parents(ac.spinContainer);A(ah,y);}H.ImageSelectorViewModel=(function(){H.ImageSelectorViewModel=function(ah){var ai=this;ai.id=E.observable();ai.url=E.observable();ai.thumbnailUrl=E.observable();ai.tooltip=E.observable();ai.version=E.observable();ai.createUrl=function(aj){if(!aj){return aj;}if(aj.indexOf("?")<0){aj=aj+"?version="+ai.version();}else{aj=aj+"&version="+ai.version();}return aj;};ai.versionedThumnailUrl=E.computed(function(){return ai.createUrl(ai.thumbnailUrl());});ai.setImage=function(aj){ai.thumbnailUrl(aj.ThumbnailUrl);ai.url(aj.ImageUrl);ai.tooltip(aj.ImageTooltip);ai.id(aj.ImageId);ai.version(aj.ImageVersion);};if(ah){ai.setImage(ah);}};H.ImageSelectorViewModel.prototype.preview=function(ah,ai){e.stopEventPropagation(ai);var ak=this.createUrl(this.url()),al=this;if(ak){var aj={onClose:function(){al.onAfterPreview();}};W.imagePreview(ak,this.tooltip(),aj);}};H.ImageSelectorViewModel.prototype.remove=function(ah,ai){e.stopEventPropagation(ai);this.setImage({});this.onAfterRemove();};H.ImageSelectorViewModel.prototype.select=function(ah,ai){var am=this,ak=function(an){am.thumbnailUrl(an.thumbnailUrl);am.url(an.publicUrl());am.tooltip(an.tooltip);am.id(an.id());am.version(an.version());am.onAfterSelect();},aj={onMediaSelect:function(an){ak(an);}},al=function(){am.onSelectClose();};e.stopEventPropagation(ai);H.openImageInsertDialog(ak,false,aj,al);};H.ImageSelectorViewModel.prototype.onAfterSelect=function(){};H.ImageSelectorViewModel.prototype.onAfterRemove=function(){};H.ImageSelectorViewModel.prototype.onAfterPreview=function(){};H.ImageSelectorViewModel.prototype.onSelectClose=function(){};return H.ImageSelectorViewModel;})();H.init=function(){console.log("Initializing bcms.media module.");e.on(v.events.insertImage,Y);e.on(v.events.insertFile,X);};e.registerInit(H.init);return H;});define("bcms.media.upload",["bcms.jquery","bcms","bcms.dynamicContent","bcms.modal","bcms.html5Upload","bcms.ko.extenders","bcms.messages"],function(a,b,d,o,i,k,n){var m={},p={dragZone:"#bcms-files-dropzone",messageBox:"#bcms-multi-file-upload-messages",fileUploadingContext:"#bcms-media-uploads",fileUploadingMasterForm:"#SaveForm",fileUploadingForm:"#ImgForm",fileUploadingTarget:"#UploadTarget",fileUploadingInput:"#uploadFile",fileUploadingResult:"#jsonResult",folderDropDown:"#SelectedFolderId",uploadButtonLabel:".bcms-btn-upload-files-text"},c={dragZoneActive:"bcms-dropzone-active"},l={loadUploadFilesDialogUrl:null,uploadFileToServerUrl:null,undoFileUploadUrl:null,loadUploadSingleFileDialogUrl:null,checkUploadedFileStatuses:null},h={uploadFilesDialogTitle:null,failedToProcessFile:null};m.links=l;m.globalization=h;m.openUploadFilesDialog=function(v,w,t){var u={uploads:new s(),rootFolderId:v,rootFolderType:w};u.uploads.filesToAccept(w==1?"image/*":"");if(i.fileApiSupported()){o.open({title:h.uploadFilesDialogTitle,onLoad:function(x){var y=a.format(l.loadUploadFilesDialogUrl,v,w);d.bindDialog(x,y,{contentAvailable:function(){j(x,u);},beforePost:function(){x.container.showLoading();},postSuccess:function(z){u.uploads.stopStatusChecking();u.uploads.removeFailedUploads();if(t&&a.isFunction(t)){t(z);}},postComplete:function(){x.container.hideLoading();}});},onCloseClick:function(){u.uploads.removeAllUploads();u.uploads.stopStatusChecking();}});}else{o.open({title:h.uploadFilesDialogTitle,onLoad:function(x){var y=a.format(l.loadUploadSingleFileDialogUrl,v,w);d.setContentFromUrl(x,y,{done:function(){q(x,u);}});},onAcceptClick:function(x){var y=a(p.fileUploadingMasterForm),z=function(A){n.refreshBox(x.container.find(p.messageBox),A);if(A.Success){try{if(t&&a.isFunction(t)){t(A);}}finally{u.uploads.stopStatusChecking();u.uploads.removeFailedUploads();x.close();}}};a.ajax({type:"POST",cache:false,url:y.attr("action"),data:y.serialize()}).done(function(A){z(A);}).fail(function(A){z(b.parseFailedResponse(A));});return false;},onCloseClick:function(){u.uploads.removeAllUploads();u.uploads.stopStatusChecking();}});}};function q(v,x){var u=v.container.find(p.fileUploadingContext).get(0),C=x.uploads,w={fileName:"Uploading",fileSize:0,fileId:null,version:null,type:null,abort:function(){}},B=new e(w),y=function(){var D=v.container.find(p.folderDropDown);if(D.length>0){var E=v.container.find(p.folderDropDown).get(0).selectedIndex;v.container.find(p.fileUploadingForm).get(0).reset();v.container.find(p.folderDropDown).get(0).selectedIndex=E;}},A,t=function(D){A=setInterval(function(){if(D.uploadProgress()>=100){D.uploadProgress(0);}else{D.uploadProgress(D.uploadProgress()+20);}},200);},z=function(){if(A){clearInterval(A);}};v.container.find(p.uploadButtonLabel).on("click",f);v.container.find(p.fileUploadingForm).find(p.folderDropDown).on("change",function(){var E=a(this).val(),D=v.container.find(p.fileUploadingMasterForm).find(p.folderDropDown);D.val(E);});v.container.find(p.fileUploadingInput).change(function(){var D=v.container.find(p.fileUploadingInput).val();if(D!=null&&D!=""){B.uploadCompleted(false);B.fileName=D;B.file.fileName=D;B.uploadProgress(0);C.activeUploads.push(B);C.uploads.push(B);t(B);v.container.find(a(p.fileUploadingForm)).submit();}});v.container.find(a(p.fileUploadingTarget)).on("load",function(){z();C.uploads.remove(B);C.activeUploads.remove(B);y();var I=a(p.fileUploadingTarget).contents().find(p.fileUploadingResult).get(0);if(I==null){return;}var H=a.parseJSON(I.innerHTML);if(H.Success==false){var D=new e(B.file);D.uploadFailed(true);D.failureMessage("");if(H.Messages){var E="";for(var G in H.Messages){E+=H.Messages[G]+" ";}D.failureMessage(E);}C.uploads.push(D);return;}var F=new e(H);F.uploadCompleted(true);F.fileId(H.Id);F.version(H.Version);F.type(H.Type);F.uploadProgress(100);if(H.IsFailed){F.uploadFailed(true);F.failureMessage(h.failedToProcessFile);}else{if(H.IsProcessing){F.uploadProcessing(true);C.startStatusChecking(C.firstTimeout);}}C.uploads.push(F);C.activeUploads.remove(F);});k.applyBindings(C,u);}function s(){var u=this,v=function(w){a.post(a.format(l.undoFileUploadUrl,w.fileId(),w.version(),w.type()));},t=function(w){u.uploads.remove(w);if(u.activeUploads.indexOf(w)!==-1){u.activeUploads.remove(w);}if(w.uploadCompleted()===false&&w.uploadFailed()===false){w.file.abort();}else{if(w.uploadCompleted()===true){v(w);}}};u.uploads=k.observableArray();u.activeUploads=k.observableArray();u.filesToAccept=k.observable("");u.cancelAllActiveUploads=function(){var x=u.activeUploads.removeAll();for(var w=0;w<x.length;w++){t(x[w]);}};u.removeUpload=function(w){t(w);};u.removeAllUploads=function(){var x=u.uploads.removeAll();for(var w=0;w<x.length;w++){t(x[w]);}};u.removeFailedUploads=function(){for(var w=0;w<u.uploads().length;w++){if(u.uploads()[w].uploadFailed()){t(u.uploads()[w]);}}};u.timeout=10000;u.firstTimeout=500;u.timer=null;u.startStatusChecking=function(w){if(!u.timer){if(!w){w=u.timeout;}u.timer=setTimeout(u.checkStatus,w);}};u.stopStatusChecking=function(){if(u.timer){clearTimeout(u.timer);u.timer=null;}};u.checkStatus=function(){var x=u.getProcessingIds(),y=function(){console.log("Failed to check uploaded files statuses");u.startStatusChecking();},w=false;u.timer=null;if(x.length>0){a.ajax({type:"POST",cache:false,url:l.checkUploadedFileStatuses,data:JSON.stringify({ids:x}),contentType:"application/json; charset=utf-8"}).done(function(F){if(F.Success){if(F.Data&&F.Data.length>0){for(var z=0;z<F.Data.length;z++){var D=F.Data[z],A=D.Id,C=D.IsProcessing===true,B=D.IsFailed===true;if(A){for(var E=0;E<u.uploads().length;E++){if(u.uploads()[E].fileId()==A){if(B){u.uploads()[E].uploadFailed(true);u.uploads()[E].uploadProcessing(false);u.uploads()[E].failureMessage(h.failedToProcessFile);}else{if(!C){u.uploads()[E].uploadProcessing(false);}else{if(C){w=true;}}}}}}}}if(w){u.startStatusChecking();}}else{y();}}).fail(function(z){y();});}};u.getProcessingIds=function(){var x=[],w;for(w=0;w<u.uploads().length;w++){if(u.uploads()[w].uploadProcessing()){x.push(u.uploads()[w].fileId());}}return x;};}function e(t){var u=this;u.file=t;u.fileId=k.observable("");u.version=k.observable(0);u.type=k.observable(0);u.uploadProgress=k.observable(0);u.uploadCompleted=k.observable(false);u.uploadFailed=k.observable(false);u.uploadProcessing=k.observable(false);u.failureMessage=k.observable("");u.uploadSpeedFormatted=k.observable();u.fileName=t.fileName;u.fileSizeFormated=g(t.fileSize);u.isProgressVisible=k.observable(true);u.uploadCompleted.subscribe(function(v){if(v===true){u.uploadProgress(100);}});}function j(v,x){var y=x.uploads,w=v.container.find(p.dragZone),t=function(z){z.preventDefault();z.stopPropagation();};w.on("dragenter dragover",function(z){t(z);w.addClass(c.dragZoneActive);w.children().hide();return false;});w.on("dragleave drop",function(z){t(z);w.removeClass(c.dragZoneActive);w.children().show();return false;});v.container.find(p.uploadButtonLabel).on("click",f);if(i.fileApiSupported()){var u=document.getElementById("bcms-media-uploads");i.initialize({uploadUrl:l.uploadFileToServerUrl,dropContainer:document.getElementById("bcms-files-dropzone"),inputField:document.getElementById("bcms-files-upload-input"),key:"File",data:{rootFolderId:x.rootFolderId,rootFolderType:x.rootFolderType},maxSimultaneousUploads:4,onFileAdded:function(z){var A=new e(z);y.activeUploads.push(A);y.uploads.push(A);var B;z.on({onCompleted:function(C){var F=JSON.parse(C);if(F.Success){y.activeUploads.remove(A);A.fileId(F.Data.FileId);A.version(F.Data.Version);A.type(F.Data.Type);clearInterval(B);A.isProgressVisible(true);A.uploadCompleted(true);if(F.Data.IsFailed){A.uploadFailed(true);A.failureMessage(h.failedToProcessFile);}else{if(F.Data.IsProcessing){A.uploadProcessing(true);A.isProgressVisible(false);y.startStatusChecking(y.firstTimeout);}}}else{A.uploadFailed(true);A.failureMessage("");if(F.Messages){var D="";for(var E in F.Messages){D+=F.Messages[E]+" ";}clearInterval(B);A.isProgressVisible(true);A.failureMessage(D);}}},onProgress:function(C){A.uploadProgress(parseInt(C,10));},onError:function(){A.uploadFailed(true);y.activeUploads.remove(A);},onTransfer:function(){A.isProgressVisible(false);B=setInterval(function(){if(A.uploadProgress()>=100){A.uploadProgress(0);}else{A.uploadProgress(A.uploadProgress()+20);}},200);}});}});k.applyBindings(y,u);}}function f(){if(a.browser.mozilla){a("#"+a(this).attr("for")).click();return false;}return true;}function r(t){return t.toFixed(1).replace(/\.0+$/,"");}function g(w){var u=1024,v=Math.pow(u,2),t=Math.pow(u,3);if(w<u){return w+" B";}if(w<v){return r(w/u)+" KB";}if(w<t){return r(w/v)+" MB";}return r(w/t)+" GB";}m.init=function(){};b.registerInit(m.init);return m;});