@using BetterCms.Module.Pages.Content.Resources
@using BetterCms.Module.Pages.Controllers
@using BetterCms.Module.Pages.ViewModels.Sitemap
@using BetterCms.Module.Root.Mvc.Helpers
@using Microsoft.Web.Mvc

<div class="bcms-tab-header bcms-js-tab-header">
    <div class="bcms-modal-frame-holder">
        <a class="bcms-sitemaps-arrow-left" data-bind="css: { 'bcms-sitemaps-arrow-inactive': !slider.canSlideLeft() }, click: slider.slideLeft, visible: slider.showSliders"></a>
        <!-- ko foreach: tabs -->
        <a class="bcms-tab-ui bcms-tab-item" data-bind="text: newPageViewModel.sitemap.title(), css: { 'bcms-active': isActive }, click: activate, attr: { id: tabId }, visible: isVisible"></a>
        <!-- /ko -->
        <a class="bcms-sitemaps-arrow-right" data-bind="css: { 'bcms-sitemaps-arrow-inactive': !slider.canSlideRight() }, click: slider.slideRight, visible: slider.showSliders"></a>
    </div>
</div>

<div class="bcms-modal-frame-holder" id="bcms-sitemap-addnewpage" data-bind="with: activeNewPageViewModel">
    @Html.MessagesBox()

    <div class="bcms-window-tabbed-options">
        <div class="bcms-tab-single">
            <!-- ko with: sitemap -->
            <div style="display: none;" data-bind="visible: showLanguages, with: language">
                <div class="bcms-top-block-holder">
                    <div class="bcms-filter-text">Edit sitemap in language:</div>
                    <div class="bcms-table-middle-box">
                        <select class="bcms-global-select" data-bind="options: languages, optionsText: 'value', optionsValue: 'key', value: languageId"></select>
                    </div>
                </div>
            </div>
            <!-- /ko -->

            <div class="bcms-tree-info-block">
                <!-- ko if: !linkIsDropped() -->
                <div class="bcms-content-titles">@NavigationGlobalization.Sitemap_AddNewPageDialog_PageNodeHeader</div>
                <!-- /ko -->
                <!-- ko if: linkIsDropped() -->
                <div class="bcms-content-titles">@NavigationGlobalization.Sitemap_AddNewPageDialog_PageNodeFooter</div>
                <!-- /ko -->
                <!-- ko with: sitemap -->
                <div class="bcms-tree-expander bcms-tree-expander-close" data-bind="click: callExpandOrCollapse, css: { 'bcms-tree-expander-close' : allNodesExpanded()}, text: allNodesExpanded() ? '@PagesGlobalization.CategoryTree_Button_CollapseAll' : '@PagesGlobalization.CategoryTree_Button_ExpandAll'"></div>
                <!-- /ko -->
            </div>

            <div class="bcms-tree-zones-holder">
                <div class="bcms-tree-drag-area-ui">
                    <!-- ko if: !linkIsDropped() -->
                    <!-- ko with: pageLink -->
                    <div data-bind="draggable: $parentContext">
                        <div class="bcms-drop-page-box" style="position: relative; z-index: 0;" data-bind="css: { 'bcms-node-box-drag': isBeingDragged() }">
                            <div class="bcms-drop-button">@NavigationGlobalization.Sitemap_AddNewPageDialog_DragButton</div>
                            <div class="bcms-content-titles">@NavigationGlobalization.Sitemap_AddNewPageDialog_PageName</div>
                            <div class="bcms-drop-text" data-bind="text: title()"></div>
                            <div class="bcms-content-titles">@NavigationGlobalization.Sitemap_AddNewPageDialog_PageUrl</div>
                            <div class="bcms-drop-text" data-bind="text: url()"></div>
                        </div>
                    </div>
                    <div class="bcms-node-drop-zone" data-bind="visible: isBeingDragged()"></div>
                    <div class="bcms-content-titles">@NavigationGlobalization.Sitemap_AddNewPageDialog_UndoMessage</div>
                    <!-- /ko -->
                    <!-- /ko -->

                    <div class="bcms-btn-main" data-bind="click: skipClicked, visible: !linkIsDropped()">@NavigationGlobalization.Sitemap_AddNewPageDialog_SkipButton</div>
                </div>

                <div class="bcms-tree-drop-area-ui">
                    <div class="bcms-sitemap-newpage">
                        @* Form is required for unobtrusive validation. *@
                        @using (Html.BeginForm<SitemapController>(f => f.SaveSitemap(null), FormMethod.Post, new { @class = "bcms-sitemap-form bcms-ajax-form" }))
                        {
                            @Html.Partial("Partial/Sitemap", new SitemapNodeViewModel())
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@Html.Partial("Partial/SitemapTemplate", new SitemapNodeViewModel())
