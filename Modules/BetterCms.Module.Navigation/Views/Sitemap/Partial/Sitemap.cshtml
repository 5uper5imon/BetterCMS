@using BetterCms.Module.Navigation.Content.Resources
@using BetterCms.Module.Root.Content.Resources

@model BetterCms.Module.Navigation.ViewModels.Sitemap.SitemapNodeViewModel

<!-- ko with: sitemap -->
<div class="bcms-expand-link-holder">
    <div class="bcms-expand-link" data-bind="click: expandAll">Expand All</div>
    <div class="bcms-expand-link" data-bind="click: collapseAll">Collapse All</div>
</div>

<div data-bind='template: { name: "bcms-navigation-sitemapnode-template" }'></div>
<!-- /ko -->

<script type="text/html" id="bcms-navigation-sitemapnode-template">
    <!-- ko if: !hasChildNodes() -->
    <div class="bcms-nodes-dropzone bcms-nodes-dropzone-active" data-bind="droppable: 'emptyListZone'">
        <div class="bcms-node-infotext">@NavigationGlobalization.Sitemap_NodeEdit_PlaceLinkHere</div>
    </div>
    <!-- /ko -->

    <!-- ko foreach: childNodes -->
    <!-- ko if: isVisible() && !isDeleted() -->
    <div class="bcms-tree-holder">
        <div data-bind="attr: { id: containerId() }, draggable: $parentContext.$index, style: { @*position: !isBeingDragged() ? 'relative' : 'absolute', *@zIndex: !isBeingDragged() ? '0' : '10' }">
            <!-- ko if: isFirstNode() -->
            <div class="bcms-nodes-dropzone" data-bind="css: { 'bcms-nodes-dropzone-active': activeZone() == 'topZone'  }, droppable: 'topZone'">
                <div class="bcms-node-infotext">@NavigationGlobalization.Sitemap_NodeEdit_PlaceLinkHere</div>
            </div>
            <!-- /ko -->

            <div class="bcms-placement-node" data-bind="css: { 'bcms-placement-node-drag': isBeingDragged(), 'bcms-placement-node-edit': isActive() }, droppable: 'middleZone'">
                <!-- ko if: hasChildNodes() -->
                <a class="bcms-expand-collapse-node" data-bind="click: toggleExpand, css: { 'bcms-expanded-nodes': isExpanded() }">&nbsp;</a>
                <!-- /ko -->
                <div class="bcms-node-info">
                    <div class="bcms-placement-title" data-bind='text: title'></div>
                    <div class="bcms-placement-path" data-bind='text: url'></div>
                </div>
                <!-- ko if: getSitemap().settings.canEditNode -->
                <div class="bcms-edit-node">
                    <div class="bcms-edit-node-holder">
                        <div class="bcms-tooltip-mark" data-title="@NavigationGlobalization.Sitemap_NodeEdit_Title_Tooltip_Title" data-message="@NavigationGlobalization.Sitemap_NodeEdit_Title_Tooltip_Message"></div>
                        @Html.TextBoxFor(m => m.Title, new {
                            data_bind = "value: title, valueUpdate: 'afterkeydown', enterPress: saveSitemapNodeWithValidation, escPress: cancelEditSitemapNode, hasfocus: isActive()",
                            @class = "bcms-editor-field-box",
                            Title = (string) null,
                            style = "width: 65%;",
                        })
                    </div>
                    <div class="bcms-edit-node-holder">
                        <div class="bcms-tooltip-mark" data-title="@NavigationGlobalization.Sitemap_NodeEdit_Url_Tooltip_Title" data-message="@NavigationGlobalization.Sitemap_NodeEdit_Url_Tooltip_Message"></div>
                        @Html.TextBoxFor(m => m.Url, new {
                            data_bind = "value: url, valueUpdate: 'afterkeydown', enterPress: saveSitemapNodeWithValidation, escPress: cancelEditSitemapNode",
                            @class = "bcms-editor-field-box",
                            Url = (string) null,
                            style = "width: 65%;",
                        })
                        <div class="bcms-btn-small" data-bind="click: saveSitemapNodeWithValidation, text: getSitemap().settings.nodeSaveButtonTitle">@RootGlobalization.Button_Ok</div>
                        <div class="bcms-btn-links-small" data-bind="click: cancelEditSitemapNode">@RootGlobalization.Button_Cancel</div>
                    </div>
                </div>
                <!-- /ko -->
                <div class="bcms-node-controls">
                    <!-- ko if: getSitemap().settings.canEditNode -->
                    <a class="bcms-icn-edit" data-bind="click: startEditSitemapNode">@RootGlobalization.Button_Edit</a>
                    <!-- /ko -->
                    <!-- ko if: getSitemap().settings.canDeleteNode -->
                    <a class="bcms-icn-delete" data-bind="click: deleteSitemapNode">@RootGlobalization.Button_Delete</a>
                    <!-- /ko -->
                </div>
            </div>
            <!-- ko if: activeZone() == 'middleZone' -->
            <div class="bcms-zone-holder">
                <div class="bcms-nodes-dropzone bcms-nodes-dropzone-active">
                    <div class="bcms-node-infotext">@NavigationGlobalization.Sitemap_NodeEdit_PlaceLinkHere</div>
                </div>
            </div>
            <!-- /ko -->
            <div class="bcms-zone-holder" data-bind="visible: isExpanded() && hasChildNodes(), template: { name: 'bcms-navigation-sitemapnode-template' }"></div>

            <!-- ko if: !isBeingDragged() -->
            <div class="bcms-nodes-dropzone" data-bind="css: { 'bcms-nodes-dropzone-active': activeZone() == 'bottomZone' }, droppable: 'bottomZone'">
                <div class="bcms-node-infotext">@NavigationGlobalization.Sitemap_NodeEdit_PlaceLinkHere</div>
            </div>
            <!-- /ko -->
        </div>
    </div>
    <!-- /ko -->
    <!-- /ko -->
</script>
